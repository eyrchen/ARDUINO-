/* Inside the code, there will be instructions on how to make your own custom program.

ONCE YOU HAVE COMPLETED THIS CODE, 
Click the verify button and if there are no errors, click the upload button
Unplug Roger from the computer
Press the button on the robot to start the code


COPY AND PASTE THE CODE BELOW INTO THE ARDUINO IDE AND START PROGRAMMING!
*/

//SETUP FOR MAIN PROGRAM
//GO TO LINE 31 TO START CODING

//constants & variables
const int fL = 8;
const int bL = 10;
const int pwmL = 9;

const int fR = 4;
const int bR = 2;
const int pwmR = 3;

const int buttonPin = 7;
const int ledPin = 6;

int buttonState = 0;
int oldButtonState = LOW;
int ledState = HIGH;
int playStatus = 1;
int programHasRun = 0;

// functions
void moveForward(double powerL, double powerR);
void moveBack(double powerL, double powerR);
void moveLeft(double powerL, double powerR);
void moveRight(double powerL, double powerR);
void moveStop();



//##################################################
// HOW TO PROGRAM

/* COMMANDS: Copy commands listed below and paste in
the space provided

// Move forward
moveForward(powerL,powerR);

// Move Backward
moveBack(powerL,powerR);

// Turn Left
moveLeft(powerL,powerR);

// Turn Right
moveRight(powerL,powerR);

// Force Stop
moveStop(); 

*/

//UNIVERSAL DELAY 

/*
The program normally uses a universal delay to decide how long 
the robot should execute a command before moving on to the next.
If you want manual delay, set the universal delay 
above to 0 and add:

delay(amount of milliseconds you want to delay);

between each function. */

unsigned long universalDelay = 2000;



//SPEED

/*
Speed values for left and right motors between -1 to 1
1 = spin forwards (clockwise)
-1 = spin backwards (counter-clockwise)
It is reccomended to keep the power level between 0 and 
1 because the movement blocks are based on values between that.
*/

double powerL = 1; // left wheel
double powerR = 1; // right wheel




//MAIN PROGRAM
void loop() {
  buttonState = digitalRead(buttonPin);

  if (buttonState != oldButtonState && buttonState == HIGH) {
    ledState = (ledState == LOW ? HIGH : LOW);
    digitalWrite(ledPin, ledState);
    playStatus = (ledState == HIGH ? 1 : 0);

    if (playStatus == HIGH && programHasRun == 0) {
      
      
      
      
      
      //########################################
      // PASTE YOUR COMMANDS (IN ORDER) HERE:
      moveForward(powerL, powerR);
      moveStop();
      moveBack(powerL, powerR);
      //########################################
    
      
      
      
      
      playStatus==LOW;
      programHasRun=1;
    }

    programHasRun = 1;

    } else if (playStatus == LOW && programHasRun == 1) {
      programHasRun = 0;
    }
  oldButtonState = buttonState;

  

  if (playStatus == HIGH && programHasRun == 1) {
    moveStop();
    digitalWrite(ledPin, LOW);
  }
  // Add the following block to reset the programHasRun flag
  // if the button is pressed again after the program has run
  if (playStatus == HIGH && programHasRun == 1 && 
      buttonState == oldButtonState && buttonState == HIGH) {
    programHasRun = 0;
    oldButtonState=LOW;
  }
}

// move forward
void moveForward(double powerL, double powerR) {
  digitalWrite(fL, 1);
  digitalWrite(bL, 0);
  analogWrite(pwmL, round(abs(powerL) * 255));

  digitalWrite(fR, 1);
  digitalWrite(bR, 0);
  analogWrite(pwmR, round(abs(powerR) * 255));

  delay(universalDelay);
}

// move backwards
void moveBack(double powerL, double powerR) {
  digitalWrite(fL, 0);
  digitalWrite(bL, 1);
  analogWrite(pwmL, round(abs(powerL) * 255));

  digitalWrite(fR, 0);
  digitalWrite(bR, 1);
  analogWrite(pwmR, round(abs(powerR) * 255));

  delay(universalDelay);
}

// turn left
void moveLeft(double powerL, double powerR) {
  digitalWrite(fL, 0);
  digitalWrite(bL, 1);
  analogWrite(pwmL, round(abs(powerL) * 255));

  digitalWrite(fR, 1);
  digitalWrite(bR, 0);
  analogWrite(pwmR, round(abs(powerR) * 255));

  delay(universalDelay);
}

// turn right
void moveRight(double powerL, double powerR) {
  digitalWrite(fL, 1);
  digitalWrite(bL, 0);
  analogWrite(pwmL, round(abs(powerL) * 255));

  digitalWrite(fR, 0);
  digitalWrite(bR, 1);
  analogWrite(pwmR, round(abs(powerR) * 255));

  delay(universalDelay);
}

// stop moving
void moveStop() {
  digitalWrite(fL, 0);
  digitalWrite(bL, 0);
  analogWrite(pwmL, 0);

  digitalWrite(fR, 0);
  digitalWrite(bR, 0);
  analogWrite(pwmR, 0);

  delay(universalDelay);
}

// SETUP
void setup() {
  // LEFT
  pinMode(fL, OUTPUT);
  pinMode(pwmL, OUTPUT); // pwm
  pinMode(bL, OUTPUT);

  // RIGHT
  pinMode(bR, OUTPUT);
  pinMode(pwmR, OUTPUT); // pwm
  pinMode(fR, OUTPUT);

  // LED
  pinMode(ledPin, OUTPUT);
  pinMode(buttonPin, INPUT_PULLUP);
}
